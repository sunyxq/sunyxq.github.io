# 单例模式

> 单例模式：限制实例化次数只能一次，一个类只有一个实例，并提供一个访问它的全局访问点。

#### 模式特点

1. 只有一个实例
2. 全局可访问实例
3. 自行实例化(主动实例化)
4. 可推迟初始化，延迟执行

## 简单版单例模式`function`版

```js
const Singleton = function(name) {
  this.name = name;
};
Singleton.prototype.getName = function() {
  return this.name;
};
Singleton.getInstance = function(name) {
  if (!Singleton.instance) {
    Singleton.instance = new Singleton(name);
  }
  return Singleton.instance;
};

const inst1 = Singleton.getInstance("Vue");
const inst2 = Singleton.getInstance("React");

inst1 === inst2; // true
```

## 简单单例模式`class`版

```js
class SimpleSingleton {
  static instance;
  constructor(name) {
    this.name = name;
  }
  static getInstance(name) {
    if (!SimpleSingleton.instance) {
      SimpleSingleton.instance = new SimpleSingleton(name);
    }
    return SimpleSingleton.instance;
  }
  getName() {
    return this.name;
  }
}

const inst1 = SimpleSingleton.getInstance("React");
const inst2 = SimpleSingleton.getInstance("Vue");
inst1 === inst2; // true
```

## 使用 new 实例化单例

```js
const CreateSingleton = (function() {
  let instance;
  return function(name) {
    if (instance) {
      return instance;
    }
    this.name = name;
    return (instance = this);
  };
})();

CreateSingleton.prototype.getName = function() {
  return this.name;
};

const ins1 = new CreateSingleton("React");
const ins2 = new CreateSingleton("Vue");

ins1 === ins2; // true
ins2.getName(); // 'React'
```

## 代理版单例模式

```js
const BaseSingleton = function(name) {
  this.name = name;
};
BaseSingleton.prototype.getName = function() {
  return this.name;
};
const ProxySingleton = (function() {
  let instance;
  return function(name) {
    if (instance) return instance;
    return (instance = new BaseSingleton(name));
  };
})();

const ins1 = new ProxySingleton("vue");
const ins2 = new ProxySingleton("react");
ins1 === ins2; // true
ins2.getName(); // vue
```

## 惰性单例模式

> 惰性单例意图解决：需要时才创建类实例对象。惰性单例是解决”按需加载(懒加载)“的问题

```js
let getSingleton = function(fn) {
  let result;
  return function(fn) {
    return result || (result = fn.apply(this, arguments));
  };
};

let createAlterMessage = function(html) {
  let div = document.createElement("div");
  div.innerHTML = div;
  div.style.display = "none";
  document.body.appendChild(div);
  return div;
};

let createAlterSingleton = getSingleton(createAlterMessage);

document.body.addEventListener("click", function() {
  let alterMsg = createAlterSingleton("login");
  alterMsg.display.style = "block";
});
```

## 参考

1. [JavaScript 设计模式（一）：单例模式](https://juejin.im/post/6844903874210299912)
